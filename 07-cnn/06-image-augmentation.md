# 이미지 증강 (Image Augmentation)

## 왜 필요한가

로봇 조작 데이터는 수집 비용이 매우 높다. 사람이 직접 로봇을 텔레오퍼레이션(teleoperation)하여 시연 데이터를 만들어야 하기 때문이다. VLA 모델의 성능은 데이터 양에 크게 의존하므로, **제한된 데이터를 최대한 활용**하는 것이 필수적이다. 이미지 증강은 기존 이미지에 다양한 변환을 적용하여 "새로운" 학습 데이터를 인위적으로 만들어내는 기법이며, 로봇 학습에서 일반화 성능을 높이는 핵심 전략이다.

---

## 핵심 개념

### 1. 왜 증강이 효과적인가

- **과적합 방지**: 적은 데이터를 반복 학습하면 모델이 학습 데이터를 암기한다. 증강은 매번 다른 변형을 보여주어 암기를 방해한다.
- **불변성 학습**: 물체를 좌우 반전해도, 밝기가 변해도 같은 물체임을 학습한다.
- **현실 세계 대응**: 실제 환경에서는 조명, 각도, 배경이 항상 변한다. 증강은 이런 변동을 모방한다.
- 핵심 원리: 라벨을 변경하지 않는 범위 내에서 입력을 변형한다.

### 2. 기본 기하학적 변환

**Random Crop (랜덤 자르기)**
- 이미지의 임의 영역을 잘라서 사용한다.
- 물체가 이미지 내 어디에 위치해도 인식할 수 있도록 한다.
- 일반적으로 원본보다 약간 작은 크기로 자른 뒤 원래 크기로 리사이즈한다.

**Random Horizontal Flip (랜덤 좌우 반전)**
- 50% 확률로 이미지를 좌우로 뒤집는다.
- 가장 기본적이면서 효과적인 증강 기법이다.
- 주의: 좌우 구분이 의미 있는 태스크(예: 글자 인식)에서는 사용하지 않는다.
- 로봇 환경에서 좌우 반전을 사용하려면 행동 라벨도 함께 반전해야 한다.

**Random Rotation (랜덤 회전)**
- 임의의 각도(-30도 ~ +30도 등)로 이미지를 회전한다.
- 물체의 방향이 다양한 상황에 대비한다.
- 과도한 회전은 비현실적인 이미지를 만들 수 있으므로 적절한 범위를 설정한다.

### 3. Color Jitter (색상 변형)

- **Brightness (밝기)**: 이미지를 밝게 또는 어둡게 변형한다. 조명 변화에 대응한다.
- **Contrast (대비)**: 밝은 부분과 어두운 부분의 차이를 조절한다.
- **Saturation (채도)**: 색의 선명도를 변형한다.
- **Hue (색조)**: 색상 자체를 약간 변화시킨다.
- 로봇 환경에서 조명 조건은 시간, 장소, 날씨에 따라 크게 변한다. Color jitter는 이런 변동에 강건한 모델을 만든다.

### 4. MixUp

단순 변환을 넘어서는 고급 증강 기법이다.

- **아이디어**: 두 장의 이미지를 **가중 평균으로 혼합**하여 새 이미지를 만든다.
- 이미지: `혼합 = alpha * 이미지A + (1-alpha) * 이미지B`
- 라벨도 동일 비율로 혼합: `혼합 라벨 = alpha * 라벨A + (1-alpha) * 라벨B`
- alpha는 보통 Beta 분포에서 샘플링한다 (예: Beta(0.2, 0.2)).
- 효과:
  - 결정 경계(decision boundary)를 매끄럽게 만든다.
  - 과도하게 확신하는 예측(overconfident prediction)을 줄인다.
  - 모델의 일반화 성능이 향상된다.

### 5. CutMix

MixUp의 공간적 변형이다.

- **아이디어**: 이미지의 **일부 영역을 잘라내고** 다른 이미지의 해당 영역으로 **붙여넣는다**.
- MixUp과 달리 전체가 흐릿해지지 않고, 두 이미지의 선명한 영역이 공존한다.
- 라벨은 잘라낸 영역의 비율에 따라 혼합한다.
- 효과:
  - 물체의 부분적 가림(occlusion)에 강건해진다.
  - 네트워크가 물체의 전체가 아닌 부분적 단서만으로도 인식하도록 한다.
  - Cutout(영역을 검은색으로 가림)보다 정보 손실이 적다.

### 6. 로봇 데이터를 위한 증강 전략

로봇 학습에서의 증강은 일반 이미지 증강과 다른 고려사항이 있다.

- **행동 라벨 일관성**: 이미지를 변환하면 대응하는 행동(action)도 변환해야 할 수 있다.
  - 좌우 반전 → 좌우 방향의 행동도 반전
  - 회전 → 회전에 맞게 행동 방향 조정
  - 자르기, 색상 변환 → 행동 라벨 변경 불필요
- **현실적 변환만 적용**: 로봇 카메라는 보통 고정되어 있으므로 과도한 회전은 비현실적이다. 조명 변화와 약간의 카메라 흔들림(crop) 정도가 현실적이다.
- **도메인 랜덤화(Domain Randomization)**: 시뮬레이션 환경에서 배경, 텍스처, 조명, 물체 색상을 극단적으로 랜덤화하여 현실 환경으로의 전이(sim-to-real transfer)를 돕는다.
- VLA 모델에서는 사전 학습 단계에서 인터넷 이미지의 자연스러운 다양성이 증강 역할을 하고, fine-tuning 단계에서 추가 증강이 제한된 로봇 데이터를 보완한다.

---

## 증강 기법 비교 요약

| 기법 | 변형 대상 | 라벨 변경 | 효과 |
|------|----------|----------|------|
| Random Crop | 위치, 크기 | 불필요 | 위치 불변성 |
| Horizontal Flip | 좌우 방향 | 경우에 따라 | 방향 불변성 |
| Rotation | 각도 | 경우에 따라 | 회전 불변성 |
| Color Jitter | 색상, 밝기 등 | 불필요 | 조명 강건성 |
| MixUp | 픽셀값 혼합 | 비율 혼합 | 매끄러운 결정 경계 |
| CutMix | 영역 교체 | 비율 혼합 | 가림 강건성 |

---

## 연습 주제

1. 증강의 강도를 너무 높이면 어떤 문제가 발생하는지 생각해 보라 (예: 90도 회전한 컵 이미지가 학습에 도움이 될까?).
2. 로봇 팔이 좌우로 물체를 미는 태스크에서, 좌우 반전 증강을 적용할 때 행동 라벨을 어떻게 변환해야 하는지 구체적으로 설명해 보라.
3. MixUp에서 alpha = 0.5일 때와 alpha = 0.1일 때 생성되는 이미지의 차이를 직관적으로 설명해 보라.
4. 학습 데이터가 100장뿐인 상황에서, 어떤 증강 기법의 조합이 가장 효과적일지 우선순위를 매겨 보라.
5. Domain randomization이 sim-to-real transfer에 왜 효과적인지, "현실적 시뮬레이션"과 비교하여 논해 보라.

---
